@model BasePageViewModel

@{
    ViewBag.PageTitle = Model.PageTitle;
    ViewBag.MetaDescription = Model.MetaDescription;
    ViewBag.CanonicalUrl = Model.CanonicalUrl;
}

@section Head {
    <script type="application/ld+json">
    {
        "@@context": "https://schema.org",
        "@@type": "LearningResource",
        "name": "Digital Flashcard Generator",
        "learningResourceType": "Study Tool",
        "description": "Create and study with digital flashcards for effective learning"
    }
    </script>
}

<section class="section-padding bg-gradient-to-br from-[var(--color-primary)] via-[var(--color-secondary)] to-[var(--color-accent)] text-white">
    <div class="container-custom">
        <div class="max-w-4xl mx-auto text-center">
            <div class="text-5xl mb-4">üÉè</div>
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Flashcard Generator</h1>
            <p class="text-xl opacity-90">Create digital flashcards and study effectively</p>
        </div>
    </div>
</section>

<section class="section-padding">
    <div class="container-custom max-w-6xl">
        
        <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-8">
            <div class="flex items-start gap-3">
                <svg class="w-5 h-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div class="text-sm text-green-900 dark:text-green-100">
                    <strong>Study smarter:</strong> All flashcard sets are saved locally in your browser. Access them anytime, even offline.
                </div>
            </div>
        </div>

        <!-- Create Mode -->
        <div id="createMode" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-2 card">
                <h2 class="text-2xl font-bold mb-6">Create Flashcard Set</h2>
                
                <div class="mb-6">
                    <label for="setName" class="block text-sm font-medium mb-2">Set Name</label>
                    <input type="text" id="setName" 
                           class="w-full px-4 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-primary)] dark:bg-gray-800"
                           placeholder="e.g., Spanish Vocabulary">
                </div>

                <div class="border-t border-[var(--color-border)] pt-6 mb-6">
                    <h3 class="text-lg font-bold mb-4">Add Card</h3>
                    
                    <div class="mb-4">
                        <label for="cardFront" class="block text-sm font-medium mb-2">Front (Question/Term)</label>
                        <textarea id="cardFront" rows="2" 
                                  class="w-full px-4 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-primary)] dark:bg-gray-800"
                                  placeholder="What appears on the front of the card"></textarea>
                    </div>

                    <div class="mb-4">
                        <label for="cardBack" class="block text-sm font-medium mb-2">Back (Answer/Definition)</label>
                        <textarea id="cardBack" rows="3" 
                                  class="w-full px-4 py-2 border border-[var(--color-border)] rounded-lg focus:ring-2 focus:ring-[var(--color-primary)] dark:bg-gray-800"
                                  placeholder="What appears on the back of the card"></textarea>
                    </div>

                    <button onclick="addCard()" class="btn-primary w-full">
                        Add Card to Set
                    </button>
                </div>

                <div id="cardsContainer" class="space-y-3">
                    <!-- Cards will appear here -->
                </div>
            </div>

            <div class="space-y-6">
                <div class="card">
                    <h3 class="text-xl font-bold mb-4">Actions</h3>
                    <div class="space-y-3">
                        <button onclick="saveSet()" class="btn-primary w-full">
                            üíæ Save Set
                        </button>
                        <button onclick="exportSet()" class="btn-secondary w-full">
                            üì§ Export JSON
                        </button>
                        <button onclick="clearSet()" class="w-full px-4 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20">
                            üóëÔ∏è Clear All
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 class="text-xl font-bold mb-4">Saved Sets</h3>
                    <div id="savedSetsList" class="space-y-2">
                        <p class="text-sm text-[var(--color-text-light)]">No saved sets yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Study Mode -->
        <div id="studyMode" class="hidden">
            <div class="card max-w-2xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="studySetName" class="text-2xl font-bold"></h2>
                    <button onclick="exitStudyMode()" class="text-sm text-[var(--color-text-light)] hover:text-[var(--color-text)]">
                        ‚úï Exit
                    </button>
                </div>

                <div class="mb-6">
                    <div class="flex justify-between text-sm mb-2">
                        <span>Card <span id="currentCard">1</span> of <span id="totalCards">0</span></span>
                        <button onclick="shuffleCards()" class="text-[var(--color-primary)] hover:underline">üîÄ Shuffle</button>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div id="studyProgress" class="bg-[var(--color-primary)] h-2 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                </div>

                <div id="flashcard" class="relative bg-gradient-to-br from-[var(--color-primary)]/10 to-[var(--color-secondary)]/10 rounded-xl p-8 min-h-[300px] flex items-center justify-center cursor-pointer border-2 border-[var(--color-primary)]/20 hover:border-[var(--color-primary)]/40 transition-all" style="transform-style: preserve-3d; transition: transform 0.6s;"
                     onclick="flipCard()">
                    <div id="cardContent" class="text-center text-lg" style="backface-visibility: visible;">
                        <!-- Card content -->
                    </div>
                    <div class="absolute bottom-4 right-4 text-sm text-[var(--color-text-light)]" style="backface-visibility: visible;">
                        Click to flip
                    </div>
                </div>

                <div class="flex gap-4 mt-6">
                    <button onclick="previousCard()" class="btn-secondary flex-1">
                        ‚Üê Previous
                    </button>
                    <button onclick="nextCard()" class="btn-primary flex-1">
                        Next ‚Üí
                    </button>
                </div>
            </div>
        </div>

    </div>
</section>

@section Scripts {
    <script>
        let currentSet = {
            name: '',
            cards: []
        };
        let savedSets = JSON.parse(localStorage.getItem('flashcardSets') || '[]');
        let studyState = { currentIndex: 0, isFlipped: false, cards: [] };

        document.addEventListener('DOMContentLoaded', () => {
            renderSavedSets();
        });

        function addCard() {
            const front = document.getElementById('cardFront').value.trim();
            const back = document.getElementById('cardBack').value.trim();

            if (!front || !back) {
                alert('Please fill both front and back of the card');
                return;
            }

            currentSet.cards.push({
                id: Date.now(),
                front,
                back
            });

            document.getElementById('cardFront').value = '';
            document.getElementById('cardBack').value = '';
            document.getElementById('cardFront').focus();

            renderCards();
        }

        function renderCards() {
            const container = document.getElementById('cardsContainer');
            if (currentSet.cards.length === 0) {
                container.innerHTML = '<p class="text-sm text-[var(--color-text-light)]">No cards added yet</p>';
                return;
            }

            container.innerHTML = `
                <h3 class="text-lg font-bold mb-3">Cards (${currentSet.cards.length})</h3>
                ${currentSet.cards.map((card, idx) => `
                    <div class="border border-[var(--color-border)] rounded-lg p-4 bg-[var(--color-surface)]">
                        <div class="flex justify-between items-start mb-2">
                            <div class="text-sm font-semibold text-[var(--color-primary)]">Card ${idx + 1}</div>
                            <button onclick="removeCard(${card.id})" class="text-red-600 hover:text-red-700">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="text-sm mb-2">
                            <strong>Front:</strong> ${card.front}
                        </div>
                        <div class="text-sm text-[var(--color-text-medium)]">
                            <strong>Back:</strong> ${card.back}
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function removeCard(id) {
            currentSet.cards = currentSet.cards.filter(c => c.id !== id);
            renderCards();
        }

        function saveSet() {
            const name = document.getElementById('setName').value.trim();
            
            if (!name || currentSet.cards.length === 0) {
                alert('Please add a name and at least one card');
                return;
            }

            currentSet.name = name;
            currentSet.id = Date.now();

            savedSets.push({...currentSet});
            localStorage.setItem('flashcardSets', JSON.stringify(savedSets));

            alert('Flashcard set saved successfully!');
            renderSavedSets();
        }

        function renderSavedSets() {
            const container = document.getElementById('savedSetsList');
            if (savedSets.length === 0) {
                container.innerHTML = '<p class="text-sm text-[var(--color-text-light)]">No saved sets yet</p>';
                return;
            }

            container.innerHTML = savedSets.map(set => `
                <div class="border border-[var(--color-border)] rounded p-3 bg-[var(--color-surface)]">
                    <div class="font-semibold text-sm mb-1">${set.name}</div>
                    <div class="text-xs text-[var(--color-text-light)] mb-2">${set.cards.length} cards</div>
                    <div class="flex gap-2">
                        <button onclick="studySet(${set.id})" class="text-xs px-2 py-1 bg-[var(--color-primary)] text-white rounded hover:opacity-90">
                            Study
                        </button>
                        <button onclick="loadSet(${set.id})" class="text-xs px-2 py-1 border border-[var(--color-border)] rounded hover:bg-[var(--color-bg)]">
                            Edit
                        </button>
                        <button onclick="deleteSet(${set.id})" class="text-xs px-2 py-1 text-red-600 hover:underline">
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadSet(id) {
            const set = savedSets.find(s => s.id === id);
            if (!set) return;

            currentSet = {...set};
            document.getElementById('setName').value = set.name;
            renderCards();
        }

        function deleteSet(id) {
            if (!confirm('Delete this flashcard set?')) return;
            savedSets = savedSets.filter(s => s.id !== id);
            localStorage.setItem('flashcardSets', JSON.stringify(savedSets));
            renderSavedSets();
        }

        function clearSet() {
            if (!confirm('Clear all cards?')) return;
            currentSet = { name: '', cards: [] };
            document.getElementById('setName').value = '';
            renderCards();
        }

        function exportSet() {
            if (!currentSet.name || currentSet.cards.length === 0) {
                alert('Please create a set first');
                return;
            }

            const dataStr = JSON.stringify(currentSet, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentSet.name.replace(/\s+/g, '_')}_flashcards.json`;
            a.click();
        }

        function studySet(id) {
            const set = savedSets.find(s => s.id === id);
            if (!set) return;

            studyState = {
                currentIndex: 0,
                isFlipped: false,
                cards: [...set.cards]
            };

            document.getElementById('createMode').classList.add('hidden');
            document.getElementById('studyMode').classList.remove('hidden');
            document.getElementById('studySetName').textContent = set.name;
            document.getElementById('totalCards').textContent = set.cards.length;

            showCard();
        }

        function showCard() {
            const card = studyState.cards[studyState.currentIndex];
            document.getElementById('currentCard').textContent = studyState.currentIndex + 1;
            const progress = ((studyState.currentIndex + 1) / studyState.cards.length) * 100;
            document.getElementById('studyProgress').style.width = `${progress}%`;

            const flashcard = document.getElementById('flashcard');
            const cardContent = document.getElementById('cardContent');
            
            // Apply rotation to the card container
            flashcard.style.transform = studyState.isFlipped ? 'rotateY(180deg)' : 'rotateY(0deg)';
            
            // Counter-rotate the content so text appears correct
            cardContent.style.transform = studyState.isFlipped ? 'rotateY(180deg)' : 'rotateY(0deg)';
            cardContent.textContent = studyState.isFlipped ? card.back : card.front;
        }

        function flipCard() {
            studyState.isFlipped = !studyState.isFlipped;
            showCard();
        }

        function nextCard() {
            studyState.isFlipped = false;
            studyState.currentIndex = (studyState.currentIndex + 1) % studyState.cards.length;
            showCard();
        }

        function previousCard() {
            studyState.isFlipped = false;
            studyState.currentIndex = studyState.currentIndex === 0 ? studyState.cards.length - 1 : studyState.currentIndex - 1;
            showCard();
        }

        function shuffleCards() {
            studyState.cards = studyState.cards.sort(() => Math.random() - 0.5);
            studyState.currentIndex = 0;
            studyState.isFlipped = false;
            showCard();
        }

        function exitStudyMode() {
            document.getElementById('studyMode').classList.add('hidden');
            document.getElementById('createMode').classList.remove('hidden');
        }
    </script>
}
