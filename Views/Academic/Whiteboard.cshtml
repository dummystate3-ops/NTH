@model BasePageViewModel

@{
    ViewBag.PageTitle = Model.PageTitle;
    ViewBag.MetaDescription = Model.MetaDescription;
    ViewBag.CanonicalUrl = Model.CanonicalUrl;
}

@section Head {
}

<section class="section-padding bg-gradient-to-br from-[var(--color-primary)] via-[var(--color-secondary)] to-[var(--color-accent)] text-white">
    <div class="container-custom">
        <div class="max-w-4xl mx-auto text-center">
            <div class="text-5xl mb-4">üé®</div>
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Interactive Whiteboard</h1>
            <p class="text-xl opacity-90">Draw, diagram, and visualize ideas</p>
        </div>
    </div>
</section>

<section class="section-padding">
    <div class="container-custom max-w-6xl">
        
        @{
            var breadcrumbs = new System.Collections.Generic.List<(string Name, string Url)>
            {
                ("Home", Url.Action("Index", "Home") ?? "/"),
                ("All Tools", Url.Action("Index", "Tools") ?? "/Tools"),
                ("Academic & Teacher Tools", (Url.Action("Index", "Tools") ?? "/Tools") + "#academic"),
                ("Interactive Whiteboard", Url.Action("Whiteboard", "Academic") ?? "#")
            };
        }
        <partial name="_Breadcrumb" model="breadcrumbs" />
        
        <div class="card mb-6">
            <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium">Tool:</label>
                    <select id="tool" class="px-3 py-2 border border-[var(--color-border)] rounded-lg dark:bg-gray-800">
                        <option value="pen">‚úèÔ∏è Pen</option>
                        <option value="eraser">üßπ Eraser</option>
                        <option value="line">üìè Line</option>
                        <option value="rectangle">‚ñ≠ Rectangle</option>
                        <option value="circle">‚óØ Circle</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium">Color:</label>
                    <input type="color" id="color" value="#4A90E2" class="w-12 h-10 border border-[var(--color-border)] rounded cursor-pointer">
                </div>
                
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium">Size:</label>
                    <input type="range" id="size" min="1" max="20" value="3" class="w-24">
                    <span id="sizeValue" class="text-sm">3</span>
                </div>
                
                <div class="flex gap-2 ml-auto">
                    <button onclick="clearCanvas()" class="px-4 py-2 border border-[var(--color-border)] rounded-lg hover:bg-[var(--color-bg)]">
                        üóëÔ∏è Clear
                    </button>
                    <button onclick="saveDrawing()" class="btn-secondary">
                        üíæ Save
                    </button>
                    <button onclick="exportDrawing()" class="btn-primary">
                        üì§ Export PNG
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <canvas id="whiteboard" 
                    class="border-2 border-[var(--color-border)] rounded-lg cursor-crosshair bg-white dark:bg-gray-900"
                    width="1000" height="600">
            </canvas>
        </div>

        <div class="mt-6 card">
            <h3 class="text-lg font-bold mb-4">Saved Drawings</h3>
            <div id="savedDrawings" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <p class="text-sm text-[var(--color-text-light)] col-span-full">No saved drawings yet</p>
            </div>
        </div>

        <!-- FAQs -->
        <div class="mt-8 card">
            <h3 class="text-xl font-semibold mb-4">Whiteboard FAQs</h3>
            <div class="space-y-4 text-sm text-[var(--color-text-medium)]">
                <div>
                    <p class="font-semibold text-[var(--color-text)] mb-1">Where are my whiteboard drawings stored?</p>
                    <p>
                        Saved drawings are stored in your browser‚Äôs local storage as image data. They remain available in this
                        browser on this device but are not synced to other devices or user accounts.
                    </p>
                </div>
                <div>
                    <p class="font-semibold text-[var(--color-text)] mb-1">Can I export my whiteboard as an image?</p>
                    <p>
                        Yes. You can export the current whiteboard as a PNG file and download it. This is useful for including
                        diagrams or sketches in notes, slides, or documentation.
                    </p>
                </div>
                <div>
                    <p class="font-semibold text-[var(--color-text)] mb-1">Does this whiteboard support real-time collaboration?</p>
                    <p>
                        No. The current version is designed for individual use within a single browser session. It does not
                        provide multi-user, real-time collaboration features like shared boards or live cursors.
                    </p>
                </div>
            </div>
        </div>

        <!-- Related tools -->
        <div class="mt-6 card">
            <h3 class="text-xl font-semibold mb-4">Related visual tools</h3>
            <div class="flex flex-wrap gap-3 text-sm">
                <a asp-controller="Academic" asp-action="MindMap" class="pill-button">
                    Mind Map Creator
                </a>
                <a asp-controller="Productivity" asp-action="KanbanBoard" class="pill-button">
                    Kanban Board
                </a>
                <a asp-controller="Productivity" asp-action="Notes" class="pill-button">
                    Online Notepad
                </a>
                <a asp-controller="ImageTools" asp-action="AdvancedResizer" class="pill-button">
                    Advance Image Tool
                </a>
            </div>
        </div>

    </div>
</section>

@section Scripts {
    <script>
        const canvas = document.getElementById('whiteboard');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let startX, startY;
        let savedDrawings = JSON.parse(localStorage.getItem('whiteboardDrawings') || '[]');

        // Initialize
        ctx.strokeStyle = '#4A90E2';
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';

        document.getElementById('size').addEventListener('input', function() {
            ctx.lineWidth = this.value;
            document.getElementById('sizeValue').textContent = this.value;
        });

        document.getElementById('color').addEventListener('input', function() {
            ctx.strokeStyle = this.value;
        });

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // Touch support
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            startX = touch.clientX - rect.left;
            startY = touch.clientY - rect.top;
            isDrawing = true;
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!isDrawing) return;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            drawShape(x, y);
        });

        canvas.addEventListener('touchend', () => {
            isDrawing = false;
        });

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            drawShape(x, y);
        }

        function drawShape(x, y) {
            const tool = document.getElementById('tool').value;
            
            if (tool === 'pen') {
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(x, y);
                ctx.stroke();
                startX = x;
                startY = y;
            } else if (tool === 'eraser') {
                ctx.clearRect(x - ctx.lineWidth / 2, y - ctx.lineWidth / 2, ctx.lineWidth, ctx.lineWidth);
            }
        }

        function stopDrawing(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const tool = document.getElementById('tool').value;
            
            if (tool === 'line') {
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(x, y);
                ctx.stroke();
            } else if (tool === 'rectangle') {
                ctx.strokeRect(startX, startY, x - startX, y - startY);
            } else if (tool === 'circle') {
                const radius = Math.sqrt(Math.pow(x - startX, 2) + Math.pow(y - startY, 2));
                ctx.beginPath();
                ctx.arc(startX, startY, radius, 0, 2 * Math.PI);
                ctx.stroke();
            }
            
            isDrawing = false;
        }

        function clearCanvas() {
            if (confirm('Clear the entire whiteboard?')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        function saveDrawing() {
            const name = prompt('Enter a name for this drawing:');
            if (!name) return;
            
            const imageData = canvas.toDataURL();
            savedDrawings.push({
                id: Date.now(),
                name,
                data: imageData,
                date: new Date().toLocaleDateString()
            });
            
            localStorage.setItem('whiteboardDrawings', JSON.stringify(savedDrawings));
            renderSavedDrawings();
            alert('Drawing saved!');
        }

        function exportDrawing() {
            const dataURL = canvas.toDataURL('image/png');
            const a = document.createElement('a');
            a.href = dataURL;
            a.download = `whiteboard_${Date.now()}.png`;
            a.click();
        }

        function renderSavedDrawings() {
            const container = document.getElementById('savedDrawings');
            
            if (savedDrawings.length === 0) {
                container.innerHTML = '<p class="text-sm text-[var(--color-text-light)] col-span-full">No saved drawings yet</p>';
                return;
            }
            
            container.innerHTML = savedDrawings.map(drawing => `
                <div class="border border-[var(--color-border)] rounded-lg p-3 bg-[var(--color-surface)]">
                    <img src="${drawing.data}" class="w-full h-24 object-contain mb-2 rounded border border-[var(--color-border)]" alt="${drawing.name}">
                    <div class="text-sm font-semibold truncate">${drawing.name}</div>
                    <div class="text-xs text-[var(--color-text-light)] mb-2">${drawing.date}</div>
                    <div class="flex gap-2">
                        <button onclick="loadDrawing(${drawing.id})" class="text-xs px-2 py-1 bg-[var(--color-primary)] text-white rounded hover:opacity-90">
                            Load
                        </button>
                        <button onclick="deleteDrawing(${drawing.id})" class="text-xs px-2 py-1 text-red-600 hover:underline">
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadDrawing(id) {
            const drawing = savedDrawings.find(d => d.id === id);
            if (!drawing) return;
            
            const img = new Image();
            img.onload = function() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
            };
            img.src = drawing.data;
        }

        function deleteDrawing(id) {
            if (!confirm('Delete this drawing?')) return;
            savedDrawings = savedDrawings.filter(d => d.id !== id);
            localStorage.setItem('whiteboardDrawings', JSON.stringify(savedDrawings));
            renderSavedDrawings();
        }

        // Initialize
        renderSavedDrawings();
    </script>
}
