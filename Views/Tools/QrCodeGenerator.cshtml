@{
    ViewData["PageTitle"] = "QR Code Generator | NovaTools Hub";
    ViewData["MetaDescription"] = "Generate QR codes for text, URLs, contact info, WiFi, and more";
}

<!-- Page Container -->
<div class="min-h-screen bg-[var(--color-bg)]">

    <!-- Header Section -->
    <div class="container-custom py-8 lg:py-10">
        <div class="max-w-4xl mx-auto">
            @{
                var breadcrumb = new System.Collections.Generic.List<(string Label, string Url)>
                {
                    ("Home", Url.Action("Index", "Home") ?? "/"),
                    ("All Tools", Url.Action("Index", "Tools") ?? "/Tools"),
                    ("QR Code Generator", Url.Action("QrCodeGenerator", "Tools") ?? "#")
                };
            }
            <partial name="_Breadcrumb" model="breadcrumb" />

            <div class="text-center space-y-4">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[var(--color-primary)]/10 text-[var(--color-primary)] text-sm font-medium">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z">
                        </path>
                    </svg>
                    Utility Tools
                </div>
                <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-[var(--color-text)]">
                    <span class="text-gradient">QR Code</span> Generator
                </h1>
                <p class="text-lg text-[var(--color-text-medium)] max-w-2xl mx-auto">
                    Create QR codes for URLs, WiFi networks, contact cards, and more. Instant generation with download.
                </p>
            </div>
        </div>
    </div>
    </div>

    <!-- Tool Workspace -->
    <div class="container-custom pb-8">
        <div class="max-w-5xl mx-auto">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

                <!-- Input Panel -->
                <div
                    class="bg-[var(--color-surface)] border border-[var(--color-border)] rounded-2xl shadow-xl overflow-hidden">
                    <div class="bg-gradient-to-r from-[var(--color-primary)] to-[var(--color-secondary)] px-5 py-4">
                        <h2 class="text-lg font-bold text-white flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                </path>
                            </svg>
                            Configure QR Code
                        </h2>
                    </div>
                    <div class="p-5 space-y-5">
                        <!-- Type Selection -->
                        <div class="space-y-2">
                            <label
                                class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Type</label>
                            <div class="grid grid-cols-4 gap-2" id="typeSelector">
                                <button data-type="url"
                                    class="type-btn active flex flex-col items-center gap-1 p-3 rounded-xl border-2 border-[var(--color-primary)] bg-[var(--color-primary)]/10 text-[var(--color-primary)] transition-all">
                                    <span class="text-lg">üîó</span>
                                    <span class="text-xs font-medium">URL</span>
                                </button>
                                <button data-type="text"
                                    class="type-btn flex flex-col items-center gap-1 p-3 rounded-xl border border-[var(--color-border)] hover:border-[var(--color-primary)] transition-all">
                                    <span class="text-lg">üìù</span>
                                    <span class="text-xs font-medium">Text</span>
                                </button>
                                <button data-type="wifi"
                                    class="type-btn flex flex-col items-center gap-1 p-3 rounded-xl border border-[var(--color-border)] hover:border-[var(--color-primary)] transition-all">
                                    <span class="text-lg">üì∂</span>
                                    <span class="text-xs font-medium">WiFi</span>
                                </button>
                                <button data-type="vcard"
                                    class="type-btn flex flex-col items-center gap-1 p-3 rounded-xl border border-[var(--color-border)] hover:border-[var(--color-primary)] transition-all">
                                    <span class="text-lg">üë§</span>
                                    <span class="text-xs font-medium">Contact</span>
                                </button>
                                <button data-type="email"
                                    class="type-btn flex flex-col items-center gap-1 p-3 rounded-xl border border-[var(--color-border)] hover:border-[var(--color-primary)] transition-all">
                                    <span class="text-lg">‚úâÔ∏è</span>
                                    <span class="text-xs font-medium">Email</span>
                                </button>
                                <button data-type="phone"
                                    class="type-btn flex flex-col items-center gap-1 p-3 rounded-xl border border-[var(--color-border)] hover:border-[var(--color-primary)] transition-all">
                                    <span class="text-lg">üìû</span>
                                    <span class="text-xs font-medium">Phone</span>
                                </button>
                                <button data-type="sms"
                                    class="type-btn flex flex-col items-center gap-1 p-3 rounded-xl border border-[var(--color-border)] hover:border-[var(--color-primary)] transition-all">
                                    <span class="text-lg">üí¨</span>
                                    <span class="text-xs font-medium">SMS</span>
                                </button>
                                <button data-type="location"
                                    class="type-btn flex flex-col items-center gap-1 p-3 rounded-xl border border-[var(--color-border)] hover:border-[var(--color-primary)] transition-all">
                                    <span class="text-lg">üìç</span>
                                    <span class="text-xs font-medium">Location</span>
                                </button>
                            </div>
                        </div>

                        <!-- Dynamic Input Fields -->
                        <div id="inputFields" class="space-y-4"></div>

                        <!-- Size Selection -->
                        <div class="space-y-2">
                            <label
                                class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Size</label>
                            <div class="flex gap-2">
                                <button data-size="128"
                                    class="size-btn flex-1 py-2 px-3 rounded-lg border border-[var(--color-border)] text-sm hover:border-[var(--color-primary)] transition-all">Small</button>
                                <button data-size="256"
                                    class="size-btn active flex-1 py-2 px-3 rounded-lg border-2 border-[var(--color-primary)] bg-[var(--color-primary)]/10 text-[var(--color-primary)] text-sm font-medium">Medium</button>
                                <button data-size="512"
                                    class="size-btn flex-1 py-2 px-3 rounded-lg border border-[var(--color-border)] text-sm hover:border-[var(--color-primary)] transition-all">Large</button>
                                <button data-size="1024"
                                    class="size-btn flex-1 py-2 px-3 rounded-lg border border-[var(--color-border)] text-sm hover:border-[var(--color-primary)] transition-all">XL</button>
                            </div>
                        </div>

                        <!-- Generate Button -->
                        <button id="generateBtn"
                            class="w-full py-3 bg-gradient-to-r from-[var(--color-primary)] to-[var(--color-secondary)] hover:opacity-90 text-white font-bold rounded-xl shadow-lg transition-all flex items-center justify-center gap-2 hover:scale-[1.02] active:scale-[0.98]">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z">
                                </path>
                            </svg>
                            Generate QR Code
                        </button>
                    </div>
                </div>

                <!-- Preview Panel -->
                <div
                    class="bg-[var(--color-surface)] border border-[var(--color-border)] rounded-2xl shadow-xl overflow-hidden">
                    <div class="px-5 py-4 border-b border-[var(--color-border)] flex items-center justify-between">
                        <h2 class="text-lg font-bold text-[var(--color-text)]">Preview</h2>
                        <span id="qrStatus" class="text-xs text-[var(--color-text-medium)]">Ready to generate</span>
                    </div>
                    <div class="p-5 flex flex-col items-center justify-center min-h-[350px]">
                        <!-- Placeholder -->
                        <div id="qrPlaceholder" class="text-center space-y-3">
                            <div
                                class="w-32 h-32 mx-auto rounded-xl border-2 border-dashed border-[var(--color-border)] flex items-center justify-center">
                                <svg class="w-12 h-12 text-[var(--color-text-medium)]/30" fill="none"
                                    stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                                        d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z">
                                    </path>
                                </svg>
                            </div>
                            <p class="text-sm text-[var(--color-text-medium)]">Your QR code will appear here</p>
                        </div>

                        <!-- QR Code Display -->
                        <div id="qrResult" class="hidden text-center space-y-4">
                            <div class="bg-white p-4 rounded-xl shadow-inner inline-block">
                                <div id="qrcode"></div>
                            </div>
                            <div class="flex gap-2 justify-center">
                                <button id="downloadBtn"
                                    class="flex items-center gap-2 px-4 py-2 bg-[var(--color-primary)] hover:opacity-90 text-white font-medium rounded-lg transition-all text-sm">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                    </svg>
                                    Download PNG
                                </button>
                                <button id="shareBtn"
                                    class="flex items-center gap-2 px-4 py-2 bg-[var(--color-bg)] border border-[var(--color-border)] hover:border-[var(--color-primary)] text-[var(--color-text)] font-medium rounded-lg transition-all text-sm">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z">
                                        </path>
                                    </svg>
                                    Share
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- How It Works Section -->
    <div class="container-custom py-10 border-t border-[var(--color-border)]">
        <div class="max-w-5xl mx-auto">
            <h2 class="text-xl font-bold text-[var(--color-text)] mb-6 text-center">Common Uses for QR Codes</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                <div
                    class="text-center space-y-2 p-4 rounded-xl bg-[var(--color-surface)] border border-[var(--color-border)]">
                    <div class="text-2xl">üåê</div>
                    <h3 class="font-semibold text-sm text-[var(--color-text)]">Websites</h3>
                    <p class="text-xs text-[var(--color-text-medium)]">Link to pages</p>
                </div>
                <div
                    class="text-center space-y-2 p-4 rounded-xl bg-[var(--color-surface)] border border-[var(--color-border)]">
                    <div class="text-2xl">üìß</div>
                    <h3 class="font-semibold text-sm text-[var(--color-text)]">Contact</h3>
                    <p class="text-xs text-[var(--color-text-medium)]">Share vCards</p>
                </div>
                <div
                    class="text-center space-y-2 p-4 rounded-xl bg-[var(--color-surface)] border border-[var(--color-border)]">
                    <div class="text-2xl">üì±</div>
                    <h3 class="font-semibold text-sm text-[var(--color-text)]">Apps</h3>
                    <p class="text-xs text-[var(--color-text-medium)]">Store links</p>
                </div>
                <div
                    class="text-center space-y-2 p-4 rounded-xl bg-[var(--color-surface)] border border-[var(--color-border)]">
                    <div class="text-2xl">üì∂</div>
                    <h3 class="font-semibold text-sm text-[var(--color-text)]">WiFi</h3>
                    <p class="text-xs text-[var(--color-text-medium)]">Easy connect</p>
                </div>
                <div
                    class="text-center space-y-2 p-4 rounded-xl bg-[var(--color-surface)] border border-[var(--color-border)]">
                    <div class="text-2xl">üí≥</div>
                    <h3 class="font-semibold text-sm text-[var(--color-text)]">Payments</h3>
                    <p class="text-xs text-[var(--color-text-medium)]">Quick pay</p>
                </div>
                <div
                    class="text-center space-y-2 p-4 rounded-xl bg-[var(--color-surface)] border border-[var(--color-border)]">
                    <div class="text-2xl">üìç</div>
                    <h3 class="font-semibold text-sm text-[var(--color-text)]">Location</h3>
                    <p class="text-xs text-[var(--color-text-medium)]">Map coords</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Tools, Ad & Social -->
    <div class="container-custom pb-10">
        <div class="max-w-3xl mx-auto space-y-6">
            <div class="card">
                <h3 class="text-xl font-semibold mb-4">QR code generator FAQs</h3>
                <div class="space-y-4 text-sm text-[var(--color-text-medium)]">
                    <div>
                        <p class="font-semibold text-[var(--color-text)] mb-1">Can I change the size of the QR code without regenerating the content?</p>
                        <p>
                            Yes. Size controls only affect the rendered image dimensions, not the encoded text. You can switch between small, medium, large, and XL to fit print or screen needs without retyping your data.
                        </p>
                    </div>
                    <div>
                        <p class="font-semibold text-[var(--color-text)] mb-1">Will all phones be able to scan these QR codes?</p>
                        <p>
                            Most modern smartphone cameras and QR reader apps can scan standard QR codes generated here. For the best results, keep sufficient contrast between foreground and background and avoid placing codes on very busy images.
                        </p>
                    </div>
                    <div>
                        <p class="font-semibold text-[var(--color-text)] mb-1">Is there a limit to how much data I can encode?</p>
                        <p>
                            Larger payloads create denser codes that are harder to scan, especially when printed small. For long URLs, consider using a link shortener first so the QR code stays simple and reliable.
                        </p>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3 class="text-lg font-semibold mb-3">Related content &amp; developer tools</h3>
                <div class="flex flex-wrap gap-3 text-sm">
                    <a asp-controller="Tools" asp-action="PasswordGenerator" class="pill-button">
                        Password Generator
                    </a>
                    <a asp-controller="Tools" asp-action="JsonFormatter" class="pill-button">
                        JSON Formatter
                    </a>
                    <a asp-controller="Tools" asp-action="FaviconGenerator" class="pill-button">
                        Favicon Generator
                    </a>
                    <a asp-controller="Tools" asp-action="ColorPaletteGenerator" class="pill-button">
                        Color Palette Generator
                    </a>
                </div>
            </div>

            @await Html.PartialAsync("_AdInContent")
            <partial name="_SocialSharing" />
        </div>
    </div>
</div>

<!-- QRCode.js library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

@section Scripts {
    <script>
        let qrCode = null;
        let currentType = 'url';
        let currentSize = 256;

        const inputTemplates = {
            text: `<div class="space-y-2">
                <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Text Content</label>
                <textarea id="qrContent" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all resize-none" rows="3" placeholder="Enter any text..."></textarea>
            </div>`,
            url: `<div class="space-y-2">
                <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Website URL</label>
                <input type="url" id="qrContent" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="https://example.com">
            </div>`,
            email: `<div class="space-y-2">
                <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Email Address</label>
                <input type="email" id="qrContent" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="email@example.com">
            </div>`,
            phone: `<div class="space-y-2">
                <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Phone Number</label>
                <input type="tel" id="qrContent" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="+1234567890">
            </div>`,
            sms: `<div class="space-y-3">
                <div class="space-y-2">
                    <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Phone Number</label>
                    <input type="tel" id="smsPhone" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="+1234567890">
                </div>
                <div class="space-y-2">
                    <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Message</label>
                    <textarea id="smsMessage" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all resize-none" rows="2" placeholder="Your message"></textarea>
                </div>
            </div>`,
            wifi: `<div class="space-y-3">
                <div class="space-y-2">
                    <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Network Name (SSID)</label>
                    <input type="text" id="wifiSSID" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="MyNetwork">
                </div>
                <div class="space-y-2">
                    <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Password</label>
                    <input type="text" id="wifiPassword" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="password123">
                </div>
                <div class="space-y-2">
                    <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Security</label>
                    <select id="wifiSecurity" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all">
                        <option value="WPA">WPA/WPA2</option>
                        <option value="WEP">WEP</option>
                        <option value="nopass">None</option>
                    </select>
                </div>
            </div>`,
            vcard: `<div class="space-y-3">
                <div class="grid grid-cols-2 gap-3">
                    <div class="space-y-2">
                        <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Full Name</label>
                        <input type="text" id="vcardName" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="John Doe">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Phone</label>
                        <input type="tel" id="vcardPhone" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="+1234567890">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="space-y-2">
                        <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Email</label>
                        <input type="email" id="vcardEmail" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="email@example.com">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Company</label>
                        <input type="text" id="vcardOrg" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="Company Name">
                    </div>
                </div>
            </div>`,
            location: `<div class="space-y-3">
                <div class="grid grid-cols-2 gap-3">
                    <div class="space-y-2">
                        <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Latitude</label>
                        <input type="text" id="locLat" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="40.7128">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-semibold uppercase tracking-wide text-[var(--color-text-medium)]">Longitude</label>
                        <input type="text" id="locLng" class="w-full bg-[var(--color-bg)] border border-[var(--color-border)] rounded-xl py-3 px-4 focus:ring-2 focus:ring-[var(--color-primary)]/30 focus:border-[var(--color-primary)] outline-none transition-all" placeholder="-74.0060">
                    </div>
                </div>
            </div>`
        };

        document.addEventListener('DOMContentLoaded', function () {
            updateInputFields();

            // Type buttons
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.type-btn').forEach(b => {
                        b.classList.remove('active', 'border-2', 'border-[var(--color-primary)]', 'bg-[var(--color-primary)]/10', 'text-[var(--color-primary)]');
                        b.classList.add('border', 'border-[var(--color-border)]');
                    });
                    btn.classList.add('active', 'border-2', 'border-[var(--color-primary)]', 'bg-[var(--color-primary)]/10', 'text-[var(--color-primary)]');
                    btn.classList.remove('border', 'border-[var(--color-border)]');
                    currentType = btn.dataset.type;
                    updateInputFields();
                });
            });

            // Size buttons
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.size-btn').forEach(b => {
                        b.classList.remove('active', 'border-2', 'border-[var(--color-primary)]', 'bg-[var(--color-primary)]/10', 'text-[var(--color-primary)]', 'font-medium');
                        b.classList.add('border', 'border-[var(--color-border)]');
                    });
                    btn.classList.add('active', 'border-2', 'border-[var(--color-primary)]', 'bg-[var(--color-primary)]/10', 'text-[var(--color-primary)]', 'font-medium');
                    btn.classList.remove('border', 'border-[var(--color-border)]');
                    currentSize = parseInt(btn.dataset.size);
                });
            });

            document.getElementById('generateBtn').addEventListener('click', generateQRCode);
            document.getElementById('downloadBtn')?.addEventListener('click', downloadQRCode);
            document.getElementById('shareBtn')?.addEventListener('click', shareQRCode);
        });

        function updateInputFields() {
            document.getElementById('inputFields').innerHTML = inputTemplates[currentType] || inputTemplates.text;
        }

        function generateQRCode() {
            let content = '';

            try {
                switch (currentType) {
                    case 'text':
                    case 'url':
                        content = document.getElementById('qrContent')?.value || '';
                        break;
                    case 'email':
                        content = `mailto:${document.getElementById('qrContent')?.value || ''}`;
                        break;
                    case 'phone':
                        content = `tel:${document.getElementById('qrContent')?.value || ''}`;
                        break;
                    case 'sms':
                        const phone = document.getElementById('smsPhone')?.value || '';
                        const message = document.getElementById('smsMessage')?.value || '';
                        content = `sms:${phone}${message ? '?body=' + encodeURIComponent(message) : ''}`;
                        break;
                    case 'wifi':
                        const ssid = document.getElementById('wifiSSID')?.value || '';
                        const password = document.getElementById('wifiPassword')?.value || '';
                        const security = document.getElementById('wifiSecurity')?.value || 'WPA';
                        content = `WIFI:T:${security};S:${ssid};P:${password};;`;
                        break;
                    case 'vcard':
                        const name = document.getElementById('vcardName')?.value || '';
                        const vcardPhone = document.getElementById('vcardPhone')?.value || '';
                        const vcardEmail = document.getElementById('vcardEmail')?.value || '';
                        const org = document.getElementById('vcardOrg')?.value || '';
                        content = `BEGIN:VCARD\nVERSION:3.0\nFN:${name}\nTEL:${vcardPhone}\nEMAIL:${vcardEmail}\nORG:${org}\nEND:VCARD`;
                        break;
                    case 'location':
                        const lat = document.getElementById('locLat')?.value || '';
                        const lng = document.getElementById('locLng')?.value || '';
                        content = `geo:${lat},${lng}`;
                        break;
                }

                if (!content || content === 'mailto:' || content === 'tel:' || content === 'geo:,') {
                    if (window.toast) window.toast.warning('Please fill in the required fields');
                    return;
                }

                const qrContainer = document.getElementById('qrcode');
                qrContainer.innerHTML = '';

                qrCode = new QRCode(qrContainer, {
                    text: content,
                    width: currentSize,
                    height: currentSize,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });

                document.getElementById('qrPlaceholder').classList.add('hidden');
                document.getElementById('qrResult').classList.remove('hidden');
                document.getElementById('qrStatus').textContent = 'Generated!';

                if (window.toast) window.toast.success('QR Code generated!');

            } catch (error) {
                console.error('QR generation error:', error);
                if (window.toast) window.toast.error('Failed to generate QR code');
            }
        }

        function downloadQRCode() {
            const canvas = document.getElementById('qrcode')?.querySelector('canvas');
            if (canvas) {
                const link = document.createElement('a');
                link.download = 'qrcode.png';
                link.href = canvas.toDataURL();
                link.click();
                if (window.toast) window.toast.success('QR Code downloaded!');
            }
        }

        function shareQRCode() {
            const canvas = document.getElementById('qrcode')?.querySelector('canvas');
            if (canvas && navigator.share) {
                canvas.toBlob(function (blob) {
                    const file = new File([blob], 'qrcode.png', { type: 'image/png' });
                    navigator.share({
                        title: 'QR Code',
                        text: 'Check out this QR code',
                        files: [file]
                    }).catch(err => console.log('Share failed:', err));
                });
            } else {
                if (window.toast) window.toast.info('Sharing not supported. Use Download instead.');
            }
        }
    </script>
}