@model NovaToolsHub.Models.ViewModels.BasePageViewModel
@{
    ViewData["Title"] = Model.PageTitle;
    ViewData["MetaDescription"] = Model.MetaDescription;
    ViewData["CanonicalUrl"] = Model.CanonicalUrl;
}

<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 dark:text-white mb-3">
            <i class="fas fa-volume-up text-primary"></i> Text to Speech
        </h1>
        <p class="text-lg text-gray-600 dark:text-gray-300">
            Convert text to natural-sounding speech
        </p>
    </div>

    <!-- Browser Compatibility Warning -->
    <div id="compatibilityWarning" class="bg-yellow-100 dark:bg-yellow-900/30 border-l-4 border-yellow-500 p-4 mb-6 hidden">
        <p class="text-yellow-700 dark:text-yellow-300">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            Text-to-Speech may not be fully supported in your browser. For best results, use Chrome, Edge, or Safari.
        </p>
    </div>

    <!-- Text Input -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">
            Enter Text
        </h2>
        
        <textarea id="textInput" rows="8" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-primary" placeholder="Type or paste text here to convert to speech..."></textarea>
        
        <div class="flex justify-between items-center mt-2 text-sm text-gray-600 dark:text-gray-400">
            <span id="charCounter">0 / 5000 characters</span>
            <button onclick="clearText()" class="text-red-600 hover:text-red-700">
                <i class="fas fa-times-circle mr-1"></i> Clear
            </button>
        </div>
    </div>

    <!-- Voice Settings -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">
            Voice Settings
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Voice
                </label>
                <select id="voiceSelect" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-primary">
                    <option value="">Default Voice</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Speed: <span id="speedValue">1.0x</span>
                </label>
                <input type="range" id="speedSlider" min="0.5" max="2" step="0.1" value="1" class="w-full" oninput="updateSpeed(this.value)">
                <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
                    <span>0.5x</span>
                    <span>2.0x</span>
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Pitch: <span id="pitchValue">1.0</span>
                </label>
                <input type="range" id="pitchSlider" min="0.5" max="2" step="0.1" value="1" class="w-full" oninput="updatePitch(this.value)">
                <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
                    <span>Low</span>
                    <span>High</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Controls -->
    <div class="bg-gradient-to-br from-primary/10 to-secondary/10 rounded-lg shadow-md p-6 mb-6">
        <div class="flex flex-wrap justify-center gap-4">
            <button id="playBtn" onclick="speak()" class="bg-primary hover:bg-blue-600 text-white font-semibold py-3 px-8 rounded-lg text-lg transition-all duration-200 transform hover:scale-105">
                <i class="fas fa-play mr-2"></i> Play
            </button>
            <button id="pauseBtn" onclick="pause()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-8 rounded-lg text-lg transition-all duration-200 transform hover:scale-105 hidden">
                <i class="fas fa-pause mr-2"></i> Pause
            </button>
            <button id="resumeBtn" onclick="resume()" class="bg-secondary hover:bg-green-600 text-white font-semibold py-3 px-8 rounded-lg text-lg transition-all duration-200 transform hover:scale-105 hidden">
                <i class="fas fa-play mr-2"></i> Resume
            </button>
            <button onclick="stop()" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-8 rounded-lg text-lg transition-all duration-200">
                <i class="fas fa-stop mr-2"></i> Stop
            </button>
            <button onclick="downloadAudio()" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-8 rounded-lg text-lg transition-all duration-200" title="Download (if supported)">
                <i class="fas fa-download mr-2"></i> Download
            </button>
        </div>
        
        <!-- Progress -->
        <div id="progressSection" class="mt-6 hidden">
            <div class="flex justify-between text-sm text-gray-600 dark:text-gray-300 mb-2">
                <span>Speaking...</span>
                <span id="progressText">0%</span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                <div id="progressBar" class="bg-primary h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>
    </div>

    @await Html.PartialAsync("_SocialSharing")

    <!-- Sample Text -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">
            Try Sample Text
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <button onclick="loadSample('hello')" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium py-2 px-4 rounded-lg text-left transition-all">
                <i class="fas fa-comment mr-2 text-primary"></i> Hello World
            </button>
            <button onclick="loadSample('paragraph')" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium py-2 px-4 rounded-lg text-left transition-all">
                <i class="fas fa-paragraph mr-2 text-primary"></i> Sample Paragraph
            </button>
            <button onclick="loadSample('numbers')" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium py-2 px-4 rounded-lg text-left transition-all">
                <i class="fas fa-hashtag mr-2 text-primary"></i> Numbers
            </button>
            <button onclick="loadSample('quote')" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium py-2 px-4 rounded-lg text-left transition-all">
                <i class="fas fa-quote-left mr-2 text-primary"></i> Inspirational Quote
            </button>
        </div>
    </div>

    <!-- Info Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">
            About Text-to-Speech
        </h2>
        <div class="space-y-4 text-gray-600 dark:text-gray-300">
            <p>
                <strong>Browser-Based:</strong> This tool uses your browser's built-in Speech Synthesis API for natural-sounding text-to-speech conversion.
            </p>
            <p>
                <strong>Multiple Voices:</strong> Choose from available system voices in different languages and accents.
            </p>
            <p>
                <strong>Customizable:</strong> Adjust speech rate (speed) and pitch to suit your preferences.
            </p>
            <p>
                <strong>Use Cases:</strong> Perfect for accessibility, language learning, proofreading, or listening to documents while multitasking.
            </p>
        </div>
    </div>

    <!-- FAQs -->
    <div class="mt-8 card">
        <h3 class="text-xl font-semibold mb-4">Text-to-speech FAQs</h3>
        <div class="space-y-4 text-sm text-[var(--color-text-medium)]">
            <div>
                <p class="font-semibold text-[var(--color-text)] mb-1">Does my text get sent to your servers?</p>
                <p>
                    The tool relies on your browser&rsquo;s Speech Synthesis API to generate speech locally. NovaTools Hub
                    does not send your text to its own servers for processing, although your browser or operating system
                    may use underlying voice services depending on your platform.
                </p>
            </div>
            <div>
                <p class="font-semibold text-[var(--color-text)] mb-1">Which browsers are best supported?</p>
                <p>
                    Modern versions of Chrome, Edge, and Safari generally provide the best support and widest voice
                    selection. Firefox support can be more limited and may not expose all voices or features.
                </p>
            </div>
            <div>
                <p class="font-semibold text-[var(--color-text)] mb-1">Can I download the spoken audio?</p>
                <p>
                    The Web Speech API does not expose a direct audio file for download. If you need a recording, you can
                    use a system or screen recording tool while the text is being spoken.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    /**
     * Text-to-Speech using Web Speech API
     * Browser compatibility: Chrome, Edge, Safari (full support), Firefox (limited)
     */
    const synth = window.speechSynthesis;
    let voices = [];
    let currentUtterance = null;

    // Check browser compatibility
    function checkCompatibility() {
        if (!synth) {
            document.getElementById('compatibilityWarning').classList.remove('hidden');
            document.getElementById('playBtn').disabled = true;
        }
    }

    // Load available voices
    function loadVoices() {
        voices = synth.getVoices();
        const select = document.getElementById('voiceSelect');
        
        select.innerHTML = '<option value="">Default Voice</option>' + 
            voices.map((voice, index) => 
                `<option value="${index}">${voice.name} (${voice.lang})${voice.default ? ' - Default' : ''}</option>`
            ).join('');
    }

    // Update speed display
    function updateSpeed(value) {
        document.getElementById('speedValue').textContent = `${parseFloat(value).toFixed(1)}x`;
    }

    // Update pitch display
    function updatePitch(value) {
        document.getElementById('pitchValue').textContent = parseFloat(value).toFixed(1);
    }

    // Speak text
    function speak() {
        const text = document.getElementById('textInput').value.trim();
        
        if (!text) {
            alert('Please enter some text to speak.');
            return;
        }
        
        if (text.length > 5000) {
            alert('Text is too long. Maximum 5000 characters allowed.');
            return;
        }
        
        // Stop any ongoing speech
        synth.cancel();
        
        // Create utterance
        currentUtterance = new SpeechSynthesisUtterance(text);
        
        // Set voice
        const voiceIndex = document.getElementById('voiceSelect').value;
        if (voiceIndex) {
            currentUtterance.voice = voices[voiceIndex];
        }
        
        // Set parameters
        currentUtterance.rate = parseFloat(document.getElementById('speedSlider').value);
        currentUtterance.pitch = parseFloat(document.getElementById('pitchSlider').value);
        
        // Event handlers
        currentUtterance.onstart = function() {
            document.getElementById('playBtn').classList.add('hidden');
            document.getElementById('pauseBtn').classList.remove('hidden');
            document.getElementById('progressSection').classList.remove('hidden');
        };
        
        currentUtterance.onend = function() {
            document.getElementById('playBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');
            document.getElementById('resumeBtn').classList.add('hidden');
            document.getElementById('progressSection').classList.add('hidden');
            document.getElementById('progressBar').style.width = '0%';
        };
        
        currentUtterance.onboundary = function(event) {
            // Update progress
            const progress = (event.charIndex / text.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = Math.round(progress) + '%';
        };
        
        // Speak
        synth.speak(currentUtterance);
    }

    // Pause speech
    function pause() {
        synth.pause();
        document.getElementById('pauseBtn').classList.add('hidden');
        document.getElementById('resumeBtn').classList.remove('hidden');
    }

    // Resume speech
    function resume() {
        synth.resume();
        document.getElementById('pauseBtn').classList.remove('hidden');
        document.getElementById('resumeBtn').classList.add('hidden');
    }

    // Stop speech
    function stop() {
        synth.cancel();
        document.getElementById('playBtn').classList.remove('hidden');
        document.getElementById('pauseBtn').classList.add('hidden');
        document.getElementById('resumeBtn').classList.add('hidden');
        document.getElementById('progressSection').classList.add('hidden');
        document.getElementById('progressBar').style.width = '0%';
    }

    // Download audio (note: Web Speech API doesn't support direct download, this is a placeholder)
    function downloadAudio() {
        alert('Direct audio download is not supported by the Web Speech API. However, you can use screen recording tools to capture the audio output.');
    }

    // Clear text
    function clearText() {
        document.getElementById('textInput').value = '';
        updateCharCount();
    }

    // Update character count
    function updateCharCount() {
        const text = document.getElementById('textInput').value;
        const count = text.length;
        document.getElementById('charCounter').textContent = `${count} / 5000 characters`;
        
        if (count > 5000) {
            document.getElementById('charCounter').classList.add('text-red-600');
        } else {
            document.getElementById('charCounter').classList.remove('text-red-600');
        }
    }

    // Load sample text
    function loadSample(type) {
        const samples = {
            hello: 'Hello! Welcome to the NovaTools Hub Text-to-Speech tool. This is a simple demonstration of speech synthesis technology.',
            paragraph: 'Text-to-speech technology has come a long way. Modern systems can produce natural-sounding speech that is almost indistinguishable from human voices. This technology has numerous applications, from accessibility tools for the visually impaired to language learning and content consumption.',
            numbers: 'One, two, three, four, five. The first ten digits are: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9. Mathematical constants include pi (3.14159) and e (2.71828).',
            quote: 'The only way to do great work is to love what you do. If you haven\'t found it yet, keep looking. Don\'t settle. - Steve Jobs'
        };
        
        document.getElementById('textInput').value = samples[type] || '';
        updateCharCount();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        checkCompatibility();
        loadVoices();
        
        // Load voices again after they're loaded (Chrome needs this)
        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = loadVoices;
        }
        
        // Character counter
        document.getElementById('textInput').addEventListener('input', updateCharCount);
        updateCharCount();
    });
</script>
